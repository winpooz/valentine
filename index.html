<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cute Pixel Proposal Game ðŸ’–</title>
<style>
body { margin:0; background:#87CEEB; overflow:hidden; }
canvas { display:block; }

button {
  position:absolute;
  padding:15px 25px;
  font-size:20px;
  background:pink;
  border:3px solid white;
  border-radius:10px;
  cursor:pointer;
  font-weight:bold;
}

#startScreen {
  position:fixed;
  width:100%;
  height:100%;
  background:#87CEEB;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:10;
}
</style>
</head>
<body>

<div id="startScreen">
  <button id="playBtn">Play Game</button>
</div>

<canvas id="game"></canvas>

<button id="yesBtn" style="display:none;">YES ðŸ’•</button>
<button id="noBtn" style="display:none;">NO ðŸ˜­</button>

<!-- Ground Valentine Heart GIF -->
<img id="heartGif" src="assets/heart.gif" style="position:absolute; width:100px; height:100px; z-index:5;">

<!-- Flying Bee -->
<img id="beeGif" src="assets/bee.gif" style="position:absolute; width:120px; height:auto; z-index:4;">

<audio id="xpSound" src="assets/xp.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ===== LOAD IMAGES =====
const girlFrames = [];
for(let i=1; i<=4; i++){
  const img = new Image();
  img.src = `assets/girl${i}.png`;
  girlFrames.push(img);
}

const tree = new Image();
tree.src = "assets/tree.png";

const grass = new Image();
grass.src = "assets/grass.png";

const topHeart = new Image();
topHeart.src = "assets/heart2.png";

const cuteHeart = new Image();
cuteHeart.src = "assets/cute.png"; // falling hearts

// ===== BUTTONS =====
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");

// ===== NO BUTTON HOVER FIX =====
noBtn.addEventListener("mouseover", ()=>{
  if(noBtn.style.display === "block"){ // only move if visible
    noBtn.style.left = Math.random()*(canvas.width - noBtn.offsetWidth) + "px";
    noBtn.style.top = Math.random()*(canvas.height - noBtn.offsetHeight) + "px";
  }
});

// ===== GAME VARIABLES =====
let player = { x: 50, y: canvas.height - 200, frame: 0 };
let clouds = [];
let petals = [];
let showQuestion = false;
let gameStarted = false;

// ===== TREES =====
const trees = [
  {x: 100, scale: 1},
  {x: 400, scale: 0.8},
  {x: 700, scale: 1.2},
  {x: 1000, scale: 1},
  {x: 1300, scale: 0.9},
];

// ===== HEARTS UI =====
let health = 5;

// ===== FALLING HEARTS =====
let fallingHearts = [];
function spawnHeart(x, y){
  fallingHearts.push({
    x,
    y,
    speed: 1 + Math.random()*2,
    life: 200
  });
}

// ===== SUN =====
function drawSun(){
  ctx.fillStyle="yellow";
  ctx.beginPath();
  ctx.arc(canvas.width-120,120,50,0,Math.PI*2);
  ctx.fill();
}

// ===== CLOUDS =====
for(let i=0;i<5;i++){
  clouds.push({x:Math.random()*canvas.width,y:50+Math.random()*200});
}

function drawClouds(){
  ctx.fillStyle="white";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,30,0,Math.PI*2);
    ctx.arc(c.x+30,c.y+10,25,0,Math.PI*2);
    ctx.arc(c.x-30,c.y+10,25,0,Math.PI*2);
    ctx.fill();
    c.x += 0.3;
    if(c.x > canvas.width+50) c.x = -50;
  });
}

// ===== PETALS =====
for(let i=0;i<100;i++){
  petals.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,speed:1+Math.random()*2});
}

function drawPetals(){
  ctx.fillStyle="pink";
  petals.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,3,0,Math.PI*2);
    ctx.fill();
    p.y += p.speed;
    if(p.y>canvas.height) p.y=0;
  });
}

// ===== TREES =====
function drawTrees(){
  const treeOffset = 30;
  trees.forEach(t=>{
    const treeHeight = tree.height * t.scale;
    const treeY = canvas.height - treeHeight - treeOffset;
    ctx.drawImage(tree, 0,0, tree.width, tree.height, t.x, treeY, tree.width * t.scale, treeHeight);
  });
}

// ===== GRASS =====
function drawGrass(){
  const scale = 0.3;
  const grassWidth = grass.width * scale;
  const grassHeight = grass.height * scale;
  const tiles = Math.ceil(canvas.width / grassWidth);
  const grassOffset = 150;

  for(let i=0;i<tiles;i++){
    const x = i * grassWidth;
    const y = canvas.height - grassHeight + grassOffset;
    ctx.drawImage(grass, 0,0, grass.width, grass.height, x, y, grassWidth, grassHeight);
  }
}

// ===== PLAYER =====
function drawPlayer(){
  ctx.drawImage(girlFrames[player.frame], 0,0,64,64, player.x, player.y, 128,128);
}

// ===== MOVE PLAYER =====
document.addEventListener("keydown", e=>{
  if(e.key==="d"){
    player.x += 10;
    player.frame++;
    if(player.frame >= girlFrames.length) player.frame = 0;
  }
});

// ===== GROUND HEART GIF =====
const heart = document.getElementById("heartGif");
const heartX = canvas.width/2 + 40;
const heartWidth = 100;
const heartHeight = 100;
const playerHeight = 128;
const heartY = player.y + playerHeight - heartHeight;

heart.style.left = heartX + "px";
heart.style.top = heartY + "px";

// ===== TOP LEFT HEARTS =====
function drawTopHearts(){
  const heartSize = 70; // bigger
  const padding = 10;
  const startY = 200; // lower, below clouds
  const startX = 20;
  for(let i=0;i<health;i++){
    ctx.drawImage(topHeart, 0,0, topHeart.width, topHeart.height,
      startX + i*(heartSize+padding), startY, heartSize, heartSize);
  }
}

// ===== BEE FLYING =====
const bee = document.getElementById("beeGif");
let beeX = 0;
let beeY = 220;
let beeSpeed = 1.5;

function moveBee(){
  beeX += beeSpeed;

  if(beeX > canvas.width - 120 || beeX < 0){
    beeSpeed *= -1;
    bee.style.transform = beeSpeed > 0 ? "scaleX(1)" : "scaleX(-1)";
  }

  let floatY = Math.sin(Date.now() * 0.002) * 10;
  bee.style.left = beeX + "px";
  bee.style.top = (beeY + floatY) + "px";

  // DROP HEARTS NEAR VALENTINE HEART
  let dx = beeX - heartX;
  let dy = beeY - heartY;
  let dist = Math.sqrt(dx*dx + dy*dy);

  if(dist < 200 && Math.random() < 0.05){
    spawnHeart(beeX, beeY);
  }
}

// ===== DRAW FALLING HEARTS =====
function drawFallingHearts(){
  for(let i=fallingHearts.length-1; i>=0; i--){
    let h = fallingHearts[i];
    h.y += h.speed;
    h.life--;

    const w = 40;
    const hgt = w * (cuteHeart.height / cuteHeart.width);
    ctx.drawImage(cuteHeart, h.x, h.y, w, hgt);

    if(h.life <= 0) fallingHearts.splice(i,1);
  }
}

// ===== FLOATING TEXT ABOVE LETTER =====
let textFloatOffset = 0;
function drawFloatingText(){
  textFloatOffset = Math.sin(Date.now() * 0.005) * 15; // moves up and down
  ctx.fillStyle = "red";
  ctx.font = "bold 30px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Read Me!", heartX + heartWidth/2, heartY - 20 + textFloatOffset);
}

// ===== QUESTION =====
function drawQuestion(){
  const questionDistance = 50;
  const heartCenterX = heartX + heartWidth/2;

  if(player.x + 64 > heartCenterX - questionDistance && player.x < heartCenterX + questionDistance){
    showQuestion = true;

    yesBtn.style.display = "block";
    noBtn.style.display = "block";

    if(noBtn.style.left === "" || noBtn.style.top === ""){
      noBtn.style.left = canvas.width/2 + 20 + "px";
      noBtn.style.top = canvas.height/2 + 60 + "px";
    }

    yesBtn.style.left = canvas.width/2 - 100 + "px";
    yesBtn.style.top = canvas.height/2 + 60 + "px";
  }

  // âœ… Restored original question text position
  if(showQuestion){
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("Will you be my Valentine, gorgeous? ðŸ’–", canvas.width/2, canvas.height/2);
  }
}

// ===== FIREWORKS =====
function fireworks(){
  for(let i=0;i<200;i++){
    let x=canvas.width/2, y=canvas.height/2;
    let a=Math.random()*Math.PI*2, s=Math.random()*6;
    let life=80;
    let interval=setInterval(()=>{
      ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;
      x+=Math.cos(a)*s;
      y+=Math.sin(a)*s;
      ctx.fillRect(x,y,4,4);
      if(--life<=0) clearInterval(interval);
    },20);
  }
}

// ===== BUTTONS =====
yesBtn.onclick=()=>{
  document.getElementById("xpSound").play();
  fireworks();
  alert("HOORAY YOU SAID YES!!! ðŸ’•ðŸŽ†");
};

// ===== GAME LOOP =====
function loop(){
  if(!gameStarted) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawSun();
  drawClouds();
  drawTopHearts();
  drawPetals();
  drawTrees();
  drawGrass();
  drawPlayer();
  drawFloatingText(); // floating "Read Me!" above letter
  drawQuestion();
  moveBee();
  drawFallingHearts();

  requestAnimationFrame(loop);
}

// ===== START =====
document.getElementById("playBtn").onclick=()=>{
  document.getElementById("startScreen").style.display="none";
  gameStarted=true;
  loop();
};
</script>
</body>
</html>
